import{p as H,v as O,T as ae,a as $,g as U,i as q,b as G,c as z,d as K,s as ne,e as C,r as ie,F as Q,f as re,h as Y,N as V,j as se,G as le,k as oe,R as I,l as J,m as F,u as X,n as ce,o as me,_ as de,q as ue,t as fe,w as pe,x as ye,M as Z,y as he,z as ge}from"./vendor.e4470cbe.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const be=async({schema:e,optimizedDocumentNode:t})=>{const n=[],i=O(t,{OperationDefinition:s=>s.name?s:{...s,name:{kind:"Name",value:"QueryOperation"}}}),o=new ae(e),y=s=>{var f;return{...s,selectionSet:{...s.selectionSet||{kind:"SelectionSet",selections:[]},selections:[...((f=s.selectionSet)==null?void 0:f.selections)||[],...ve]}}},m=(s,f)=>{let d=f;const _=[];return s.forEach(v=>{d=d[v],Array.isArray(d)||d.kind==="Field"&&_.push(d.name.value)}),_},l=(s,f,d,_,v)=>{const p=m(_,v[0]),u=w=>{var P,R;const S=[];return O(w,$(o,{Field:{enter:E=>{var M,T,N;if(o.enter(E),E.name.value!==w.name.value)if((M=E.selectionSet)!=null&&M.selections.length){const A=u(E);return S.push({name:E.name.value,alias:((T=E.alias)==null?void 0:T.value)||E.name.value,fields:A.fields}),!1}else S.push({name:E.name.value,alias:((N=E.alias)==null?void 0:N.value)||E.name.value})},leave:E=>{o.leave(E)}}})),S!=null&&S.length?{name:w.name.value,alias:((P=w.alias)==null?void 0:P.value)||w.name.value,fields:S}:{name:w.name.value,alias:((R=w.alias)==null?void 0:R.value)||w.name.value}},h=u(s),D=(w=>{if(!w)return[];const P=((E,M)=>E.reduce((T,N)=>({...T,[N[M]]:[...T[N[M]]||[],N]}),{}))(w,"alias"),R=[];return Object.entries(P).forEach(([E,M])=>{const T=[];M.forEach(ee=>{var W;(W=ee.fields)==null||W.forEach(te=>T.push(te))});const N=M[0].name,A=M[0].alias;T!=null&&T.length?R.push({name:N,alias:A,fields:T}):R.push({name:N,alias:A})}),R})(h.fields);D!=null&&D.length?n.push({name:h.name,alias:h.alias,fields:D,path:p}):n.push({name:h.name,alias:h.alias,path:p})},g={InlineFragment:{enter:s=>{o.enter(s)},leave:s=>{o.leave(s)}},Field:{enter:(s,f,d,_,v)=>{o.enter(s);const p=o.getType();if(p){const u=U(p);if(q(u)&&u.name==="Node"||G(u)&&u.getTypes().every(j=>j.getInterfaces().some(D=>D.name==="Node"))||z(u)&&u.getInterfaces().some(h=>h.name==="Node"))return y(s)}}}},c={InlineFragment:{enter:s=>{o.enter(s)},leave:s=>{o.leave(s)}},Field:{enter:(s,f,d,_,v)=>{o.enter(s);const p=o.getType();if(p){const u=U(p);if(q(u)&&u.name==="Node"||G(u)&&u.getTypes().every(j=>j.getInterfaces().some(D=>D.name==="Node"))||z(u)&&u.getInterfaces().some(h=>h.name==="Node"))return l(s,f,d,_,v),!1}}}},b=O(i,$(o,g));return O(b,$(o,c)),{formifiedQuery:b,blueprints:n}},_e=H(`
 query Sample {
  ...on Document {
    _internalValues: _values
    _internalSys: _sys {
      breadcrumbs
      basename
      filename
      path
      extension
      relativePath
      title
      template
      collection {
        name
        slug
        label
        path
        format
        matches
        templates
        fields
        __typename
      }
      __typename
    }
  }
 }`),ve=_e.definitions[0].selectionSet.selections,Ee=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",initial:"initializing",states:{initializing:{invoke:{src:"initializer",onDone:[{actions:["storeFormAndData","notifyParent"],target:"ready"}],onError:[{actions:"handleError",target:"error"}]}},ready:{},error:{}}},{actions:{notifyParent:ne(e=>({type:"DOCUMENT_READY",value:e.id})),handleError:(e,t)=>{console.error(t.data)},storeFormAndData:C((e,t)=>({...e,form:t.data.form,data:t.data.data}))},services:{initializer:async e=>{const t=e.cms.api.tina;let n;e.data?n=e.data:n=(await t.request(`query GetNode($id: String!) {
        node(id: $id) {
          ...on Document {
            _internalValues: _values
            _internalSys: _sys {
              breadcrumbs
              basename
              filename
              path
              extension
              relativePath
              title
              template
              collection {
                name
                slug
                label
                path
                format
                matches
                templates
                fields
                __typename
              }
              __typename
            }
          }
        }
      }`,{variables:{id:e.id}})).node;const r=e.cms.api.tina.schema;if(!r)throw new Error("Schema must be provided");const a=r.getCollection(n._internalSys.collection.name);let i;if(a.templates?i=a.templates.find(c=>{if(typeof c=="string")throw new Error("Global templates not supported");return c.name===n._internalSys.template}):i=a,!i)throw new Error(`Unable to find template for node ${n._internalSys.path}`);const o=ie({collection:a,basename:n._internalSys.filename,schema:r,template:i}),y=async c=>{try{const b=`#graphql
              mutation UpdateDocument($collection: String!, $relativePath: String!, $params: DocumentUpdateMutation!) {
                updateDocument(collection: $collection, relativePath: $relativePath, params: $params) {
                  __typename
                }
              }
            `;await e.cms.api.tina.request(b,{variables:{collection:n._internalSys.collection.name,relativePath:n._internalSys.relativePath,params:r.transformPayload(n._internalSys.collection.name,c)}}),e.cms.alerts.success("Document saved!")}catch(b){e.cms.alerts.error("There was a problem saving your document"),console.error(b)}},m={id:e.id,label:n._internalSys.title||n._internalSys.collection.label,initialValues:n._internalValues,fields:o.fields,onSubmit:y},l=e.formifyCallback;return{form:Se(m,e.cms,c=>l?l(c,e.cms):c.createForm(c.formConfig),!0),data:n}}}}),we=(e,t)=>({createForm:a=>new Q(a),createGlobalForm:(a,i)=>new Q({...a,global:{global:!0,...i}})}),Se=(e,t,n,r=!1,a)=>{const{createForm:i,createGlobalForm:o}=we(),y="SKIPPED";let m,l;const g=()=>{l=y};if(!l){if(n?m=n({formConfig:e,createForm:i,createGlobalForm:o,skip:g},t):m=i(e),!(m instanceof Q)){if(l===y)return;throw new Error("formify must return a form or skip()")}return m}},x={id:null,data:null,variables:{},documentMap:{},documents:[],documentNode:{kind:"Document",definitions:[]},iframe:null},Fe=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",type:"parallel",states:{pipeline:{initial:"idle",states:{idle:{entry:"clear",on:{ADD_QUERY:{target:"initializing"},SUBDOCUMENTS:{target:"pending"},IFRAME_MOUNTED:{actions:"setIframe"}}},initializing:{invoke:{src:"initializer",onDone:[{actions:"storeInitialValues",target:"pending"}],onError:[{actions:"handleError",target:"error"}]}},waiting:{on:{DOCUMENT_READY:{target:"pending"}}},pending:{invoke:{src:"setter",onDone:[{target:"ready"}],onError:[{actions:"handleMissingDocument",target:"waiting"}]}},ready:{entry:"resolveData",invoke:{src:"onChangeCallback"},on:{NAVIGATE:{target:"idle"},REMOVE_QUERY:{target:"idle"},FIELD_CHANGE:{target:"pending"}}},error:{}}}}},{actions:{handleError:(e,t)=>console.error(t.data),handleMissingDocument:C((e,t)=>{if(t.data instanceof B){if(e.documentMap[t.data.id]||!t.data.id)return e;const n=e.documents.find(a=>a._internalSys.path===t.data.id),r={ref:oe(Ee.withContext({id:t.data.id,cms:e.cms,formifyCallback:e.formifyCallback,form:null,data:n||null}))};return{...e,documentMap:{...e.documentMap,[t.data.id]:{...r,skipFormRegister:t.data.skipFormRegister}}}}else return console.error(t.data),e}),clear:C(e=>(e.cms.forms.all().forEach(t=>{e.cms.forms.remove(t.id)}),{...x,formifyCallback:e.formifyCallback,cms:e.cms,iframe:e.iframe})),storeInitialValues:C((e,t)=>({...e,...t.data})),setIframe:C((e,t)=>({...e,iframe:t.value})),resolveData:C((e,t)=>{var n,r;return e.iframe&&((r=(n=e.iframe)==null?void 0:n.contentWindow)==null||r.postMessage({type:"updateData",id:e.id,data:t.data.data})),{...e,data:t.data.data}})},services:{setter:async e=>{const t=e.cms.api.tina.schema,n=e.cms.api.tina.gqlSchema,r=[],a=await re({schema:n,source:Y(e.documentNode),rootValue:e.data,variableValues:e.variables,fieldResolver:(m,l,g,c)=>{var d,_,v;const b=c.fieldName,s=[];c.fieldNodes.forEach(p=>{p.alias&&s.push(p.alias.value)});let f=m[b];if(f||s.forEach(p=>{const u=m[p];u&&(f=u)}),b==="_sys")return m._internalSys;if(b==="_values")return m._internalValues;if(Te(c.returnType)){const p=m[b];let u=!1;if(!p)return null;let h="";if(typeof p=="string"?(u=!0,h=p):h=p._internalSys.path,e.documentMap[h]){const D=(d=e.documentMap[h].ref.getSnapshot())==null?void 0:d.context;if(!D)throw new Error(`Document not set up properly for id: ${h}`);const{data:w,form:S}=D,P=S==null?void 0:S.values;if(!w||!S||!P)throw new Error(`Document not set up properly for id: ${h}`);const R=w._internalSys.collection.name,E=D.data,M=L({fields:S.fields,values:P,tinaSchema:t}),T=t.getTemplateForData({data:S.values,collection:t.getCollection(R)});return{...E,...M,_sys:w._internalSys,id:h,__typename:V.dataTypeName(T.namespace)}}else return(v=(_=c.path)==null?void 0:_.prev)!=null&&v.prev&&(u=!0),r.push({id:h,skipFormRegister:u}),null}return f}});if(r.length>0){const m=r[0];throw new B("Unable to resolve form for initial document",m.id,m.skipFormRegister)}const i="__meta__";function*o(m){const l=new Set;function*g(c,b=[]){if(!l.has(c)){l.add(c);for(let s of Object.keys(c)){const f=b.concat(s);yield[s,c[s],f,c],c[s]!==null&&typeof c[s]=="object"&&["_internalSys","_internalValues","_sys",i].includes(s)&&(yield*g(c[s],f))}}}yield*g(m)}const y=[];for(let[m,l,g,c]of o(a.data))if(l!=null&&l._internalSys){y.push(g);const b={},f=y.filter(d=>g.join(".").startsWith(d.join("."))).reduce(function(d,_){return d.length<_.length?d:_});Object.keys(l).map(d=>{if(["__typename","_internalSys","_internalValues","_sys"].includes(d))return!1;b[d]=[...g.slice(f.length+1),d].join(".")}),l[i]={id:l==null?void 0:l._internalSys.path,name:g.slice(f.length).join("."),fields:b}}else if(typeof l=="object"&&!Array.isArray(l)&&l!==null&&m!==i){const b=y.filter(s=>g.join(".").startsWith(s.join(".")));if(b.length){const s=b.reduce(function(v,p){return v.length<p.length?v:p}),d=se(a.data,s.join("."))._internalSys.path,_={};Object.keys(l).map(v=>{if(["__typename","_internalSys","_internalValues","_sys"].includes(v))return!1;_[v]=[...g.slice(s.length),v].join(".")}),l[i]={id:d,name:g.slice(s.length).join("."),fields:_}}}return{data:a.data}},initializer:async(e,t)=>{const r=await e.cms.api.tina.getSchema(),a=H(t.value.query),{formifiedQuery:i}=await be({schema:r,optimizedDocumentNode:a}),o=await e.cms.api.tina.request(Y(i),{variables:t.value.variables}),y=[];return JSON.stringify(o,(m,l)=>(l!=null&&l._internalValues&&y.push(l),l)),{data:o,documents:y,variables:t.value.variables,documentNode:i,id:t.value.id}},onChangeCallback:e=>(t,n)=>{const r=e.cms.api.tina.schema;Object.values(e.documentMap).forEach(a=>{var m,l,g;if(!e.registerSubForms&&a.skipFormRegister)return;const i=(m=a.ref.getSnapshot())==null?void 0:m.context,o=(l=i==null?void 0:i.data)==null?void 0:l._internalSys.collection.name,y=r.getCollection(o||"");i!=null&&i.form&&((g=y.ui)!=null&&g.global?e.cms.plugins.add(new le(i.form)):e.cms.forms.add(i.form))}),e.cms&&(e.cms.events.subscribe("forms:fields:onChange",a=>{Object.keys(e.documentMap).includes(a.formId)&&t({type:"FIELD_CHANGE"})}),e.cms.events.subscribe("forms:reset",a=>{Object.keys(e.documentMap).includes(a.formId)&&t({type:"FIELD_CHANGE"})}))}}});class B extends Error{constructor(t,n,r){super(t),this.name="QueryError",this.id=n,this.skipFormRegister=r}}const Te=e=>{const t=U(e);if(q(t)&&t.name==="Node"||G(t)&&t.getTypes().every(r=>r.getInterfaces().some(a=>a.name==="Node"))||z(t)&&t.getInterfaces().some(n=>n.name==="Node"))return!0},L=({fields:e,values:t,tinaSchema:n})=>{const r={};return e.forEach(a=>{const i=t[a.name];typeof i>"u"||i!==null&&(r[a.name]=De({field:a,value:i,tinaSchema:n}))}),r},De=({field:e,value:t,tinaSchema:n})=>{switch(e.type){case"object":{if(e.templates&&e.list&&Array.isArray(t))return t.map(a=>{const i=e.templates[a._template];if(typeof i=="string")throw new Error("Global templates not supported");return{__typename:V.dataTypeName(i.namespace),...L({fields:i.fields,values:a,tinaSchema:n})}});const r=e.fields;if(typeof r=="string")throw new Error("Global templates not supported");if(!r)throw new Error(`Expected to find sub-fields on field ${e.name}`);if(e.list){if(Array.isArray(t))return t.map(a=>({__typename:V.dataTypeName(e.namespace),...L({fields:r,values:a,tinaSchema:n})}))}else return{__typename:V.dataTypeName(e.namespace),...L({fields:r,values:t,tinaSchema:n})}}default:return t}},Me=e=>{const[t,n]=I.useState(null);return I.useEffect(()=>{e.iframeRef.current&&(window.addEventListener("message",r=>{r.data.type==="open"&&n(r.data)}),window.addEventListener("message",r=>{var a,i,o,y;((a=r==null?void 0:r.data)==null?void 0:a.type)==="isEditMode"&&((y=(o=(i=e.iframeRef)==null?void 0:i.current)==null?void 0:o.contentWindow)==null||y.postMessage({type:"tina:editMode"}))}))},[e.iframeRef.current]),J("div",{className:"tina-tailwind",children:[t&&F(Ne,{payload:t,iframeRef:e.iframeRef,formifyCallback:e.formifyCallback},t.id),F("iframe",{id:"tina-iframe",ref:e.iframeRef,className:"h-screen w-full bg-white",src:e.url})]})},Ne=e=>{const t=X(),n=I.useMemo(()=>Fe.withContext({...x,cms:t,formifyCallback:e.formifyCallback}),[]),[r,a]=ce(n);return I.useEffect(()=>{r.matches("pipeline.ready")?t.events.dispatch({type:"forms:register",value:"complete"}):r.matches("pipeline.initializing")&&t.events.dispatch({type:"forms:register",value:"start"})},[JSON.stringify(r.value)]),I.useEffect(()=>{e.iframeRef.current&&(a({type:"IFRAME_MOUNTED",value:e.iframeRef.current}),e.payload.type==="open"&&a({type:"ADD_QUERY",value:e.payload}),window.addEventListener("message",i=>{i.data.type==="close"&&a({type:"REMOVE_QUERY"})}))},[e.iframeRef.current]),null},Re=new Object({NODE_ENV:"production"}).HEAD||new Object({NODE_ENV:"production"}).VERCEL_GIT_COMMIT_REF||"main",k=me({branch:Re,clientId:"a3c1daad-57df-499f-99ed-91a4e64ddeb7",token:"be725d2df80cb3b9c17b2e9bc3e181caf5502b24",build:{outputFolder:"admin",publicFolder:"/"},media:{tina:{mediaRoot:"/assets/images",publicFolder:"/"}},schema:{collections:[{label:"Projects",name:"projects",path:"_projects",fields:[{type:"string",name:"title",label:"Title",isTitle:!0,required:!0},{type:"string",name:"intro",label:"Lead"},{type:"rich-text",name:"description",label:"Description",isBody:!0},{type:"object",name:"publications",label:"Publications",list:!0,ui:{itemProps:e=>({label:e==null?void 0:e.name})},fields:[{type:"string",name:"lang",label:"Language(s)"},{type:"object",name:"links",label:"Links",list:!0,ui:{itemProps:e=>({label:e==null?void 0:e.name})},fields:[{type:"string",name:"name",label:"Title",isTitle:!0,required:!0},{type:"string",name:"url",label:"URL",ui:{component:"textarea"}}]},{type:"string",name:"name",label:"Name",isTitle:!0,required:!0},{type:"string",name:"url",label:"URL"}]},{type:"rich-text",name:"team_initiators",label:"Team initiators"},{type:"rich-text",name:"team_participants",label:"Team participants"},{type:"datetime",name:"date",label:"Date"}]},{label:"Posts",name:"posts",path:"_posts",ui:{filename:{readonly:!1,slugify:e=>{var t;const n=new Date,r=`0${n.getDate()}`.slice(-2),a=`0${n.getMonth()+1}`.slice(-2);return`${`${n.getFullYear()}-${a}-${r}`}-${(t=e==null?void 0:e.title)==null?void 0:t.toLowerCase().replace(/ /g,"-")}`}}},fields:[{type:"string",name:"title",label:"Title",isTitle:!0,required:!0},{type:"rich-text",name:"body",label:"Content",description:"This is the markdown body",isBody:!0}]}]}}),Ie=I.lazy(()=>de(()=>import("./index.9ccebf79.js"),["assets/index.9ccebf79.js","assets/vendor.e4470cbe.js"])),Pe=e=>{const[t,n]=I.useState(!1);return F(Z.Component,{rawMode:t,setRawMode:n,...e,rawEditor:F(he.exports.Suspense,{fallback:F("div",{children:"Loading raw editor..."}),children:F(Ie,{...e,setRawMode:n,rawMode:t})})})},ke=({outputFolder:e})=>{const t=X();return t.flags.set("tina-preview",e),t.fields.add({...Z,Component:Pe}),null},Ce=()=>{const e={...k==null?void 0:k.schema,config:k};return J(fe,{...k,schema:e,client:{apiUrl:"https://content.tinajs.io/content/a3c1daad-57df-499f-99ed-91a4e64ddeb7/github/main"},children:[F(ke,{outputFolder:k.build.outputFolder}),F(pe,{preview:Me,config:k})]})},je=()=>{const{setEdit:e}=ye();return e(!0),F("div",{children:"Going into edit mode"})};function Ae(){return F(ue,{editMode:F(Ce,{}),children:F(je,{})})}ge.render(F(I.StrictMode,{children:F(Ae,{})}),document.getElementById("root"));
//# sourceMappingURL=index.2fdb7c3c.js.map
